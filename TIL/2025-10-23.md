# Today I Learned

## 振り返り

今日は pgAdmin 4 でデータベースに接続して、ER 図を作成してみました。
ポート競合が発生して解決できたものの、まだ操作には十分慣れていないです。今後の課題はコマンド操作に慣れることです。

## 学んだこと

### ER 図

ER 図は Entity Relationship Diagram の略です。複数のテーブルの関係性を可視化するには、ER 図を用います。

#### 1 : N（1 対多）

社員テーブルと子どもテーブルがあるとします。

社員テーブル

| 社員 ID | 名前 |
| :-----: | :--: |
|    1    | 佐藤 |
|    2    | 田中 |
|    3    | 鈴木 |

子どもテーブル

| 社員 ID | 子供 |
| :-----: | :--: |
|    1    | 太郎 |
|    1    | 花子 |
|    3    | 次郎 |
|    3    | 三郎 |

表を見ると、1 人の社員に 0 人以上の子どもが紐づくことをテーブルで表現できています。これが 1 対多 (1 : N) の関係です。

#### pgAdmin 4 を使って ER 図を作成する手順

まず、データベースを作成します。（既に存在する場合はこの手順は不要）

`psql -d postgres -c "CREATE DATABASE learning_log_db;"`

説明：

- `-d postgres` : 接続先（既存の postgres データベース）
- `-c "CREATE DATABASE learning_log_db;"` : 新規 DB 作成

新規データベースを作成したら、初期化用の SQL ファイルを読み込みます。

`psql -d learning_log_db -f sql_practice.sql`

説明：

- `-d learning_log_db` : どの DB に対して実行するか指定
- `-f sql_practice.sql` : 実行する SQL ファイルを指定

その後、pgAdmin 4 を起動して ER 図（ERD）を生成します。初回はサーバー（接続）登録が必要です。

#### ポート競合を解決する方法（例：5432 が使用中）

状況：PostgreSQL のデフォルトポート 5432 が他プロセスで使用中。

対処フロー：

1. 誰がリッスンしているか確認：`lsof -i :5432`
2. もし不要な一時プロセスなら停止 / kill を検討
3. 既存サービスを残したい場合は、自分のローカル PostgreSQL のポートを変更

ポート変更手順（Homebrew 版 PostgreSQL の例）：

1. 停止：`brew services stop postgresql@16`
2. 設定ファイル場所を確認：`ls -l /opt/homebrew/var/postgresql@16/`
3. 設定編集：`nano /opt/homebrew/var/postgresql@16/postgresql.conf`
4. 行 `#port = 5432` をアンコメントし `port = 5433` に変更（コメント `#` を外すのを忘れない）
5. 再起動：`brew services restart postgresql@16`
6. 接続確認：`psql -p 5433 -d <DB名>`

### 論理設計のまとめ

1. これは何をするためのシステムなのかを考えて、中心となるテーブルを抽出する
2. 5W1H を考えて、中心となるテーブルの周辺のテーブルを見出す
3. 必要な項目をテーブルに属性（カラム）として入れていく
4. 主キーと外部キーを設定する
5. 正規化する
